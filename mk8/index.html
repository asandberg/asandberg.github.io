<!DOCTYPE html>
<html>
    <head>
        <title>Thousand Bulbasaur Bar</title>
        <style>
            * {
                font-family: Tahoma;
            }
            th {
                text-align: left;
                cursor: pointer;
            }
            
            td, th {
                border: 1px solid rgba(0,0,0,0.2);
                padding: 0.5em;
            }
            
            tr:nth-child(2n) td {
                background-color: rgba(0,0,0,0.15);
            }
        </style>
         <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script type="text/javascript" src="tablesorter.js"></script> 
    </head>
    <body onload="init()">
        <table id="table">
            <thead>
            <th data-sort="int">#</th>
            <th data-sort="string">Name</th>
            <th data-sort="int">FFAs played</th>
            <th data-sort="int">Point total</th>
            <!-- <th data-sort="float">Average position</th> -->
            <!-- <th data-sort="float">Average score</th> -->
            <th data-sort="int">1st</th>
            <th data-sort="int">2nd</th>
            <th data-sort="int">3rd</th>
            <th data-sort="int">4th</th>
            <th data-sort="int">5th</th>
            <th data-sort="int">6th</th>
            <th data-sort="int">7th</th>
            <th data-sort="int">8th</th>
            <th data-sort="int">9th</th>
            <th data-sort="int">10th</th>
            <th data-sort="int">11th</th>
            <th data-sort="int">12th</th>
                </thead>
            <tbody id="data">
            </tbody>
        </table>
        
        <script>
            
            
            function init() {
                
                $.getJSON("http://asandberg.github.io/mk8/data.json",  {}, function(data) {
                    
                    
                    var players = {};
                    
                    for(var ffa in data) {
                        
                        for(var p in data[ffa]) {
                         
                            var player = data[ffa][p];
                            
                            if(!players[player.name])
                                players[player.name] = {
                                    ffas: 1,
                                    positions: [ parseInt(player.position) ],
                                    points: [ parseInt(player.points) ]
                                };
                            else {
                                
                                players[player.name].ffas++;
                                players[player.name].positions.push(parseInt(player.position));
                                players[player.name].points.push(parseInt(player.points));
                            }
                        }
                    }
                    var n = 1;
                    for(var p in players) {
                        
                        if(p == "")
                            continue;
                    
                        var row = $("<tr>");
                        
                        row.append('<td>' + n + '</td>');
                        row.append('<td>' + p + '</td>');
                        row.append('<td>' + players[p].ffas + '</td>');
                        row.append('<td>' + arraySum(players[p].points) + '</td>');
                        //row.append('<td>' + Math.floor(arraySum(players[p].positions) / players[p].ffas * 10) / 10 + '</td>');
                        //row.append('<td>' + Math.floor(arraySum(players[p].points) / players[p].ffas * 10) / 10 + '</td>');
                        
                        var pos = [0,0,0,0,0,0,0,0,0,0,0,0];
                        
                        for(var i in players[p].positions) {
                            
                            pos[players[p].positions[i] - 1]++;
                            
                            
                        }
                        
                        for(var i in pos) 
                            row.append('<td>' + pos[i] + '</td>');
                            
                        
                        $("#data").append(row);
                    
                        n++;
                    }
                    
                    console.log(players);
                    $("#table").stupidtable();
                });
                
                
            }
            
            function arraySum(array) {
                var sum = 0;
                for(var i in array)
                    sum += array[i];
                return sum;
            }
        </script>
    </body>
</html>